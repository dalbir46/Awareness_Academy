<!-- âœ… Isko aapke given code me <script> ke andar, sabse niche add kar diya hai -->
<script>
  // ---- Mathpix Snippet Converter ----
  function createSnippetTools(q) {
    const ab = document.getElementById('ans' + q);

    // wrapper div banayenge (sirf admin ke liye)
    const wrapper = document.createElement("div");
    wrapper.className = "snippet-tools small";
    wrapper.style.marginTop = "8px";
    wrapper.style.display = isAdmin() ? "block" : "none";

    wrapper.innerHTML = `
      <textarea id="snippetInput${q}" rows="3" placeholder="Paste Mathpix LaTeX snippet here" style="width:100%;padding:6px;margin-bottom:4px;"></textarea>
      <button onclick="convertSnippet(${q})" style="padding:4px 8px;border:none;border-radius:4px;background:#673ab7;color:#fff;font-weight:700;cursor:pointer;">Convert</button>
      <textarea id="convertedCode${q}" rows="3" readonly style="width:100%;margin-top:6px;padding:6px;"></textarea>
      <div id="preview${q}" style="margin-top:6px;padding:8px;border:1px dashed #999;background:#fafafa;border-radius:6px;"></div>
    `;
    ab.insertAdjacentElement("afterend", wrapper);
  }

  function convertSnippet(q) {
    const input = document.getElementById("snippetInput" + q).value.trim();
    if (!input) return alert("Paste Mathpix snippet first!");

    // converted HTML+MathJax code
    const converted =
      `<div class="math-answer">\\[${input}\\]</div>`;

    // dusre textarea me save
    document.getElementById("convertedCode" + q).value = converted;

    // preview me render
    document.getElementById("preview" + q).innerHTML = converted;
    if (window.MathJax) MathJax.typesetPromise();
  }

  // Update UI ko extend kar rahe hain taki snippet tools sirf Admin ke liye dikhe
  const oldUpdateUI = updateUI;
  updateUI = function() {
    oldUpdateUI();
    document.querySelectorAll('.snippet-tools').forEach(div => {
      div.style.display = isAdmin() ? 'block' : 'none';
    });
  };

  // Load hote hi har question ke liye snippet tool banega
  window.addEventListener("load", () => {
    for (let i = 1; i <= 20; i++) {
      if (document.getElementById("ans" + i)) {
        createSnippetTools(i);
      }
    }
  });
      </script>
