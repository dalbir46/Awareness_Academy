<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mathpix Snippet Converter</title>
  <script>
    MathJax = {
      tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] }
    };
  </script>
  <script id="MathJax-script" async
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
  </script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background:#f9f9f9; }
    textarea { width: 100%; min-height: 150px; padding: 10px; margin-bottom: 10px; border-radius: 6px; border: 1px solid #ccc; font-family: monospace; }
    button { padding: 8px 16px; border:none; border-radius:6px; background:#673ab7; color:#fff; font-weight:bold; cursor:pointer; }
    .output-area { margin-top: 20px; }
    .preview { margin-top: 15px; padding: 15px; background: #fff; border: 1px dashed #aaa; border-radius: 6px; }
    label { font-weight: bold; display:block; margin-bottom:6px; }
    p { margin: 5px 0; }
  </style>
</head>
<body>
  <h2>📘 Mathpix Snippet → MathJax Converter</h2>
  <label for="snippetInput">Paste Mathpix Snippet:</label>
  <textarea id="snippetInput" placeholder="Paste your LaTeX/Mathpix snippet here..."></textarea>
  <button onclick="convertSnippet()">Convert</button>

  <div class="output-area">
    <label for="convertedCode">Converted HTML + MathJax Code:</label>
    <textarea id="convertedCode" readonly></textarea>

    <div>
      <label>Live Preview:</label>
      <div id="preview" class="preview"></div>
    </div>
  </div>

  <script>
    function autoCleanLatex(input) {
      let cleaned = input;

      // Tabular → Array
      cleaned = cleaned.replace(/\\begin\{tabular\}(\{[^\}]*\})/g, "\\begin{array}$1");
      cleaned = cleaned.replace(/\\end\{tabular\}/g, "\\end{array}");
      cleaned = cleaned.replace(/\\hline/g, "\\hline ");

      // Convert block $$...$$ → \[...\] (inline untouched)
      cleaned = cleaned.replace(/\$\$([\s\S]*?)\$\$/g, "\\[\n$1\n\\]");

      return cleaned;
    }

    function convertSnippet() {
      let input = document.getElementById("snippetInput").value.trim();
      if (!input) return alert("⚠️ Please paste a Mathpix snippet first!");

      let cleaned = autoCleanLatex(input);

      // Split lines for text/math separation
      let lines = cleaned.split(/\n/);
      let convertedHTML = "";
      let insideMath = false;

      lines.forEach(line => {
        line = line.trim();
        if (!line) return;

        // Already block math
        if (line.startsWith("\\[") || line.startsWith("\\]")) {
          convertedHTML += line + "\n";
          insideMath = false;
        }
        // Array or alignment (block math)
        else if (line.startsWith("\\begin") || line.startsWith("\\end") || line.match(/&/)) {
          if (!insideMath) {
            convertedHTML += "\\[\n";
            insideMath = true;
          }
          convertedHTML += line + "\n";
          if (line.startsWith("\\end")) {
            convertedHTML += "\\]\n";
            insideMath = false;
          }
        } 
        // Normal text (keep inline math $...$ as is)
        else {
          if (insideMath) {
            convertedHTML += "\\]\n";
            insideMath = false;
          }
          convertedHTML += `<p>${line}</p>\n`;
        }
      });

      if (insideMath) convertedHTML += "\\]\n";

      // Show converted code
      document.getElementById("convertedCode").value = convertedHTML;

      // Render preview
      document.getElementById("preview").innerHTML = convertedHTML;
      if (window.MathJax) MathJax.typesetPromise();
    }
  </script>
</body>
</html>
