<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Class 10 â€” Chapter 1: Real Numbers</title>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <style>
    :root{--accent1:#6a11cb;--accent2:#2575fc;--card:#fff;--muted:#666}
    body{font-family:Arial,Helvetica,sans-serif;background:#f0f8ff;margin:0;color:#000}
    .header-wrapper,.footer-wrapper{background:linear-gradient(135deg,var(--accent1),var(--accent2));padding:12px}
    .header,.footer-inner{background:#ffffcc;padding:14px;text-align:center;font-weight:700;border:2px solid #333;border-radius:10px;max-width:980px;margin:auto}
    .container{max-width:980px;margin:18px auto;padding:0 12px}
    .login-row{display:flex;gap:8px;justify-content:center;margin-bottom:14px}
    .login-row input{padding:8px;border-radius:6px;border:1px solid #999}
    .login-row button{padding:8px 12px;border-radius:6px;border:none;background:#0b62ff;color:#fff;font-weight:700;cursor:pointer}
    #adminStatus{display:none;color:green;font-weight:700;text-align:center;margin-bottom:8px}
    #logoutBtn{display:none;background:#ff5722;color:#fff;font-weight:700;padding:6px 12px;border:none;border-radius:6px;cursor:pointer;margin-bottom:12px}
    .question-box{background:var(--card);border:1px solid #ddd;border-radius:8px;padding:12px;margin:10px 0}
    .question-title{font-weight:700;margin-bottom:8px}
    .answer-box{min-height:56px;border:1px dashed #bbb;padding:10px;border-radius:6px;background:#fff}
    .answer-box[contenteditable='false']{background:#f7f7f7}
    .btns{margin-top:8px}
    .btn{padding:6px 10px;border-radius:6px;border:none;margin-right:6px;cursor:pointer;color:#fff;font-weight:700}
    .btn-edit{background:#2196F3}
    .btn-save{background:#4CAF50}
    .btn-clear{background:#f44336}
    .btn-copy{background:#FF9800}
    .btn-render{background:#9C27B0}
    input.latexInput{display:block;width:100%;margin-top:6px;padding:6px;border:1px solid #ccc;border-radius:6px}
    .small{font-size:13px;color:var(--muted)}
    .meta{font-size:12px;color:#777;margin-top:6px}
    @media(max-width:700px){.login-row{flex-direction:column;align-items:center}}
  </style>
</head>
<body>
  <div class="header-wrapper">
    <div class="header">Mathematics Hub â€” Class 10 | Chapter 1: Real Numbers</div>
  </div>

  <div class="container">
    <div class="login-row">
      <input id="loginUser" placeholder="Username" />
      <input id="loginPass" placeholder="Password" type="password" />
      <button id="loginBtn">Login as Admin</button>
    </div>
    <div id="adminStatus">âœ… Admin login successful</div>
    <button id="logoutBtn">ðŸ”’ Logout</button>

    <div id="questions"></div>

    <div class="small">Note: Use the Render button to convert LaTeX into images using your API and store via imgbb.</div>
  </div>

  <div class="footer-wrapper"><div class="footer-inner">Â© 2025 Mathematics Hub</div></div>

  <script>
    // ================= CONFIG =================
    const ADMIN_USERNAME = "admin";
    const ADMIN_PASSWORD = "Dalbir@551";
    const API_URL = "https://admin-pannel-1l76.onrender.com/render"; // Render API
    const IMGBB_API_KEY = "9a1627658ec3732fd03cb87cbff0ed66"; // imgbb

    // ================= HELPERS =================
    function isAdmin(){ return sessionStorage.getItem("isAdmin")==="true"; }
    function setAdmin(flag){
      if(flag) sessionStorage.setItem("isAdmin","true");
      else sessionStorage.removeItem("isAdmin");
      updateUI();
    }
    function updateUI(){
      document.getElementById("adminStatus").style.display = isAdmin() ? "block" : "none";
      document.getElementById("logoutBtn").style.display = isAdmin() ? "inline-block" : "none";
      document.querySelectorAll(".btn-save,.btn-edit,.btn-clear").forEach(b=>{
        b.style.display = isAdmin() ? "inline-block":"none";
      });
      document.querySelectorAll(".answer-box").forEach(ab=>{
        ab.contentEditable = isAdmin();
        if(!isAdmin()) ab.setAttribute("contenteditable","false");
      });
    }

    // Upload image blob to imgbb
    async function uploadToImgbb(blob){
      return new Promise((resolve,reject)=>{
        const reader=new FileReader();
        reader.onloadend=()=>{
          const base64=reader.result.split(",")[1];
          fetch("https://api.imgbb.com/1/upload?key="+IMGBB_API_KEY,{
            method:"POST",
            headers:{"Content-Type":"application/x-www-form-urlencoded"},
            body:"image="+encodeURIComponent(base64)
          })
          .then(r=>r.json())
          .then(d=>{
            if(d && d.data && d.data.url) resolve(d.data.url);
            else reject("Upload failed");
          })
          .catch(err=>reject(err));
        };
        reader.readAsDataURL(blob);
      });
    }

    // Call Render API, then upload to imgbb
    async function renderLatex(latex,qid){
      try{
        let res = await fetch(API_URL,{
          method:"POST",
          headers:{"Content-Type":"application/json"},
          body:JSON.stringify({latex:latex})
        });
        let data = await res.json();
        if(data.image_base64){
          // convert base64 to blob
          let byteChars=atob(data.image_base64);
          let byteNumbers=new Array(byteChars.length);
          for(let i=0;i<byteChars.length;i++) byteNumbers[i]=byteChars.charCodeAt(i);
          let byteArray=new Uint8Array(byteNumbers);
          let blob=new Blob([byteArray],{type:"image/png"});
          // upload to imgbb
          let url=await uploadToImgbb(blob);
          document.getElementById("ans"+qid).innerHTML = `<img src="${url}" alt="latex output"/>`;
        }else{
          document.getElementById("ans"+qid).innerHTML = "âŒ Error: "+(data.error||"Unknown");
        }
      }catch(err){
        document.getElementById("ans"+qid).innerHTML="âš ï¸ API failed: "+err;
      }
    }

    // ================= LOGIN =================
    document.getElementById("loginBtn").addEventListener("click",()=>{
      const u=document.getElementById("loginUser").value.trim();
      const p=document.getElementById("loginPass").value;
      if(u===ADMIN_USERNAME && p===ADMIN_PASSWORD){
        setAdmin(true);
        alert("âœ… Admin login successful");
      }else{
        alert("âŒ Invalid credentials");
        setAdmin(false);
      }
    });
    document.getElementById("logoutBtn").addEventListener("click",()=>{
      setAdmin(false);
      alert("ðŸ”’ You have been logged out");
    });

    // ================= QUESTIONS =================
    const questionTexts = [
      "Ex 1.1 â€” Q1. Express each number as a product of its prime factors",
      "Ex 1.1 â€” Q2. Find the HCF and LCM...",
      "Ex 1.1 â€” Q3. Find HCF and LCM by prime factorisation..."
    ];
    let qHTML="";
    questionTexts.forEach((q,i)=>{
      let id=i+1;
      qHTML+=`
        <div class="question-box" id="q${id}">
          <div class="question-title">${q}</div>
          <div class="answer-box" id="ans${id}" contenteditable="false"></div>
          <input id="latexInput${id}" class="latexInput" placeholder="Enter LaTeX for Q${id}..." />
          <div class="btns small">
            <button class="btn btn-edit" data-q="${id}">Edit</button>
            <button class="btn btn-save" data-q="${id}">Save</button>
            <button class="btn btn-clear" data-q="${id}">Clear</button>
            <button class="btn btn-copy" data-q="${id}">Copy</button>
            <button class="btn btn-render" onclick="renderLatex(document.getElementById('latexInput${id}').value,${id})">Render Answer</button>
          </div>
        </div>`;
    });
    document.getElementById("questions").innerHTML=qHTML;

    // ================= EXTRA BTNS =================
    document.addEventListener("click",e=>{
      if(e.target.classList.contains("btn-clear")){
        let q=e.target.dataset.q;
        if(!isAdmin()) return alert("Admin only");
        document.getElementById("ans"+q).innerHTML="";
      }
      if(e.target.classList.contains("btn-edit")){
        let q=e.target.dataset.q;
        if(!isAdmin()) return alert("Admin only");
        document.getElementById("ans"+q).focus();
      }
      if(e.target.classList.contains("btn-save")){
        let q=e.target.dataset.q;
        if(!isAdmin()) return alert("Admin only");
        alert("ðŸ’¾ Saved Q"+q+" (Firebase save add karna hoga)");
      }
    });

    window.onload=()=>{ updateUI(); };
  </script>
</body>
  </html>
